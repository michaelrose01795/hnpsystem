-- // file location: src/lib/database/schema/addtable.sql
-- // description: defines supplemental tables added beyond reference schema

-- added
CREATE TABLE public.job_requests ( -- // stores each job request as its own row
  request_id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- // surrogate primary key for job requests
  job_id integer NOT NULL REFERENCES public.jobs(id), -- // foreign key linking to jobs table
  description text NOT NULL, -- // details of the work requested
  hours numeric(6,2), -- // estimated labour hours for the request
  job_type text NOT NULL DEFAULT 'Customer', -- // billing type such as customer or warranty
  sort_order integer NOT NULL DEFAULT 1, -- // preserves order of requests entered on the form
  created_at timestamp with time zone NOT NULL DEFAULT now(), -- // creation timestamp
  updated_at timestamp with time zone NOT NULL DEFAULT now() -- // last update timestamp
); -- // end job_requests definition

-- added
CREATE TABLE public.job_cosmetic_damage ( -- // stores cosmetic damage flags and notes per job
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- // surrogate primary key for cosmetic records
  job_id integer NOT NULL UNIQUE REFERENCES public.jobs(id), -- // enforce single cosmetic record per job
  has_damage boolean NOT NULL DEFAULT false, -- // whether any cosmetic damage present
  notes text, -- // textual description of cosmetic issues
  created_at timestamp with time zone NOT NULL DEFAULT now(), -- // creation timestamp
  updated_at timestamp with time zone NOT NULL DEFAULT now() -- // last update timestamp
); -- // end job_cosmetic_damage definition 

-- added
CREATE TABLE public.user_signatures ( -- // stores signature assets for each workshop user
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- // surrogate primary key
  user_id integer NOT NULL UNIQUE REFERENCES public.users(user_id), -- // link to users table
  storage_path text NOT NULL, -- // Supabase storage path
  file_url text NOT NULL, -- // public URL for downloaded signature
  created_at timestamp with time zone NOT NULL DEFAULT now(), -- // creation timestamp
  updated_at timestamp with time zone NOT NULL DEFAULT now() -- // last update timestamp
); -- // end user_signatures definition

-- added
CREATE TABLE public.job_check_sheets ( -- // stores uploaded check-sheet templates per job
  sheet_id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- // primary key for check sheets
  job_id integer NOT NULL REFERENCES public.jobs(id), -- // associated job id
  file_name text NOT NULL, -- // original filename
  file_type text, -- // MIME type for viewer hints
  file_url text NOT NULL, -- // public URL for the uploaded sheet
  storage_path text NOT NULL, -- // Supabase storage path for the sheet
  created_by integer REFERENCES public.users(user_id), -- // technician who uploaded the sheet
  signature_url text, -- // preloaded signature asset for auto-fill
  created_at timestamp with time zone NOT NULL DEFAULT now(), -- // creation timestamp
  updated_at timestamp with time zone NOT NULL DEFAULT now() -- // last update timestamp
); -- // end job_check_sheets definition

-- added
CREATE TABLE public.job_check_sheet_checkboxes ( -- // stores interactive checkbox coordinates for each sheet
  checkbox_id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- // primary key for checkbox rows
  sheet_id bigint NOT NULL REFERENCES public.job_check_sheets(sheet_id) ON DELETE CASCADE, -- // linked check sheet
  label text, -- // label displayed near the checkbox
  position_x numeric(10,6) NOT NULL, -- // normalized X coordinate (0-1)
  position_y numeric(10,6) NOT NULL, -- // normalized Y coordinate (0-1)
  is_checked boolean DEFAULT false, -- // default checkbox state
  created_at timestamp with time zone NOT NULL DEFAULT now() -- // creation timestamp
); -- // end job_check_sheet_checkboxes definition

CREATE TABLE public.job_customer_statuses ( -- // stores waiting/loan/collection status linked to job cards
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- // surrogate primary key for status rows
  job_id integer NOT NULL REFERENCES public.jobs(id) ON DELETE CASCADE, -- // job reference
  status text NOT NULL DEFAULT 'Neither', -- // status such as Waiting, Loan Car, Collection
  created_at timestamp with time zone NOT NULL DEFAULT now(), -- // creation timestamp
  updated_at timestamp with time zone NOT NULL DEFAULT now() -- // update timestamp
); -- // end job_customer_statuses definition
